<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2026-02-04 Mi 16:53 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>X-Technologien</title>
<meta name="author" content="Stefan Schuh" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="solarized-light.min.css" />

<script src="org-info.min.js">
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
// @license-end
</script>

<script>
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
org_html_manager.set("TOC_DEPTH", "3");
org_html_manager.set("LINK_HOME", "");
org_html_manager.set("LINK_UP", "");
org_html_manager.set("LOCAL_TOC", "1");
org_html_manager.set("VIEW_BUTTONS", "0");
org_html_manager.set("MOUSE_HINT", "underline");
org_html_manager.set("FIXED_TOC", "0");
org_html_manager.set("TOC", "1");
org_html_manager.set("VIEW", "1");
org_html_manager.setup();  // activate after the parameters are set
// @license-end
</script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">X-Technologien</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgb1dae37">XML</a>
<ul>
<li><a href="#org7962be7">Präsentation</a></li>
</ul>
</li>
<li><a href="#org056a44f">X-Technologien Überblick</a>
<ul>
<li><a href="#orgf329229">XPath</a></li>
<li><a href="#org885bc7e">XQuery</a></li>
<li><a href="#org8e6439f">XSLT</a></li>
</ul>
</li>
<li><a href="#org31fca42">Das XQuery and XPath Data Model (XDM)</a>
<ul>
<li><a href="#org0f09ecd">Wichtige Begriffe</a>
<ul>
<li><a href="#org8ac280b">Items</a></li>
<li><a href="#org352c985">Atomare Werte</a></li>
<li><a href="#org1e3cf03">Knoten</a></li>
<li><a href="#orgc479fbf">Funktionen</a></li>
<li><a href="#orge89d017">Die Sequenz</a></li>
<li><a href="#org52da86b">Document Order</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org4655578">XPath</a>
<ul>
<li><a href="#org40fee4b">Pfadausdrücke</a>
<ul>
<li><a href="#org943b254">Achsen</a></li>
<li><a href="#org5397a2e">Prädikate</a></li>
</ul>
</li>
<li><a href="#orga59fe01">Vergleichsausdrücke</a>
<ul>
<li><a href="#orgc54e00b">Value comparisons</a></li>
<li><a href="#org656201a">General comparisons</a></li>
</ul>
</li>
<li><a href="#org08224a6">Logische Ausdrücke</a>
<ul>
<li><a href="#org6109bb3">Effective Boolean Value</a></li>
</ul>
</li>
<li><a href="#xpath-funktionen">Funktionen</a>
<ul>
<li><a href="#org1d1b298">Beispiele</a></li>
</ul>
</li>
<li><a href="#org0de1e63">Beispielabfragen</a></li>
</ul>
</li>
<li><a href="#orgdf9276c">XSLT</a>
<ul>
<li><a href="#orgd21ee97">Verarbeitungsmodell</a></li>
<li><a href="#orgf4b1c88">Ablauf einer Transformation</a>
<ul>
<li><a href="#org9beeb8b">Eingabedaten</a></li>
<li><a href="#org2c82e1e">Grundidee</a></li>
<li><a href="#org5ded8d5">Ablauf im Detail</a></li>
<li><a href="#orgb140f67">Wichtige Eigenschaften</a></li>
<li><a href="#org53f3d4a">Beispielablauf</a></li>
<li><a href="#org17f746a">Ablaufdiagramm</a></li>
</ul>
</li>
<li><a href="#orga057027">Wichtige Deklarationen und Anweisungen</a>
<ul>
<li><a href="#orgd526838">xsl:template</a></li>
<li><a href="#org7f26a9a">Entscheidungen treffen: <code>xsl:if</code> und <code>xsl:choose</code></a></li>
<li><a href="#org50d0721">xsl:copy-of und xsl:sequence</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgf2880fe">Starten von Transformationen und Tests</a>
<ul>
<li><a href="#org28185a6">Eine Transformation starten</a></li>
<li><a href="#org7542027">Tests laufen lassen</a></li>
</ul>
</li>
<li><a href="#org8a4310b">Beispiele</a>
<ul>
<li><a href="#org0c6cf67">Text in Subfeld ändern</a></li>
<li><a href="#orga0a3c96">337 aus 338 generieren</a></li>
<li><a href="#org8867e78">Bindestriche aus ISBN in 020 entfernen</a></li>
<li><a href="#org1f9404f">Feld 655</a></li>
</ul>
</li>
<li><a href="#org11e570e">Übungen</a>
<ul>
<li><a href="#org365f8ae">ex01: Felder löschen</a>
<ul>
<li><a href="#org7c7d29a">ex01_01: Lösche das Feld <code>998</code></a></li>
<li><a href="#orgd360288">ex01_02: Lösche <code>77308$$9</code></a></li>
</ul>
</li>
<li><a href="#org6d4d2cb">ex02: Felder nach inhaltlichen Kriterien löschen</a>
<ul>
<li><a href="#orgc51cf3b">ex02_01:</a></li>
<li><a href="#org38f0f21">ex02_02:</a></li>
<li><a href="#orgba561ea">ex02_03:</a></li>
</ul>
</li>
<li><a href="#org4450d24">ex03: Felder umbenennen</a>
<ul>
<li><a href="#orga6d4535">ex03_02: 653 bedingungslos nach 982 verschieben</a></li>
<li><a href="#org3a06108">ex03_02: Hochschulschriftenvermerk von <code>500##</code> nach <code>502##</code> verschieben</a></li>
</ul>
</li>
<li><a href="#org1d07f92">ex04: Feldinhalte ändern</a>
<ul>
<li><a href="#org8f428cd">ex04_01: Falsche GND-Nummer in 655</a></li>
</ul>
</li>
<li><a href="#org8c130fc">ex05: LDR/19 je nach Gegebenheiten setzen</a></li>
<li><a href="#org571224f">ex06: 773 bearbeiten</a></li>
<li><a href="#orgf5dd7b1">ex07: Ein ganzer Datensatz</a></li>
</ul>
</li>
<li><a href="#orgc643de7">Spezifikationen</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgb1dae37" class="outline-2">
<h2 id="orgb1dae37">XML</h2>
<div class="outline-text-2" id="text-orgb1dae37">
</div>
<div id="outline-container-org7962be7" class="outline-3">
<h3 id="org7962be7">Präsentation</h3>
<div class="outline-text-3" id="text-org7962be7">
<p>
<a href="https://www.stefanschuh.at/slides/slides/ULG2_4_2024/xml_ulg.html">https://www.stefanschuh.at/slides/slides/ULG2_4_2024/xml_ulg.html</a>
</p>
</div>
</div>
</div>
<div id="outline-container-org056a44f" class="outline-2">
<h2 id="org056a44f">X-Technologien Überblick</h2>
<div class="outline-text-2" id="text-org056a44f">
</div>
<div id="outline-container-orgf329229" class="outline-3">
<h3 id="orgf329229">XPath</h3>
<div class="outline-text-3" id="text-orgf329229">
<p>
Die bekannteste und wichtigste Funktion von XPath ist die navigation innerhalb einer XML-Struktur. Sprache zur Adressierung und Verarbeitung von Werten, die dem <a href="#org31fca42">XDM</a> entsprechen. XPath ist eine &ldquo;hosted language&rdquo; in XSLT. Dort wird sie u. A. verwendet um Knoten zu Adressieren (in <code>match</code> und <code>select</code>-Attributen), aber auch, um Sequenzen von Werten zu erzeugen (z. B. in Variablendefinitionen).
</p>
</div>
</div>
<div id="outline-container-org885bc7e" class="outline-3">
<h3 id="org885bc7e">XQuery</h3>
<div class="outline-text-3" id="text-org885bc7e">
<p>
XQuery ist eine Abfragesprache für XML-Datenbanken. Die Sprache ist ein Superset von XPath, d. h. jeder gültige XPath-Ausdruck ist auch ein gültiger XQery-Ausdruck &#x2013; aber nicht umgekehrt. Sie dient nicht nur dazu, Knoten(mengen) auszuwählen, sondern auch dazu Daten zu aggregieren, Reports (vorzugsweise wieder in XML) zu erstellen, etc.
</p>
</div>
</div>
<div id="outline-container-org8e6439f" class="outline-3">
<h3 id="org8e6439f">XSLT</h3>
<div class="outline-text-3" id="text-org8e6439f">
<p>
Die &ldquo;XSL Transformations (XSLT)&rdquo; dienen zur Transformation von XML, vorzugsweise in anderes XML. Die Sprache ist deklarativ und streng funktional. Diese Eigenschaften machen eignen sie besonders für komplexe Anwendungsfälle: Der funktionale Aufbau macht es unwahrscheinlicher, dass, wenn man an einem Schräubchen dreht, sich andere Schrauben unbemerkt mitdrehen. Ihre Syntax ist selbst wieder XML. Diese, <a href="https://de.wikipedia.org/wiki/Homoikonizit%C3%A4t">Homoikonizität</a> genannte, Eigenschaft macht es möglich XSLT zu XSLT zu transformieren. Das passiert in einer recht simplen Form auch tatsächlich bei den Normalisierungen für Alma.
</p>
</div>
</div>
</div>
<div id="outline-container-org31fca42" class="outline-2">
<h2 id="org31fca42">Das XQuery and XPath Data Model (XDM)</h2>
<div class="outline-text-2" id="text-org31fca42">
<p>
XPath operiert nicht anhand der textuellen Struktur eines XML-Dokuments, sondern anhand des abstrakten Baumes, der durch Parsen von XML-Dokumenten oder -Fragmenten instanziiert wird.
</p>
</div>
<div id="outline-container-org0f09ecd" class="outline-3">
<h3 id="org0f09ecd">Wichtige Begriffe</h3>
<div class="outline-text-3" id="text-org0f09ecd">
</div>
<div id="outline-container-org8ac280b" class="outline-4">
<h4 id="org8ac280b">Items</h4>
<div class="outline-text-4" id="text-org8ac280b">
<p>
Ein <code>item</code> ist entweder <a href="#org352c985">atomarer Wert</a>, ein <a href="#org1e3cf03">Knoten</a> oder eine <a href="#xpath-funktionen">Funktion</a>.
</p>
</div>
</div>
<div id="outline-container-org352c985" class="outline-4">
<h4 id="org352c985">Atomare Werte</h4>
<div class="outline-text-4" id="text-org352c985">
<p>
Atomare Werte sind Werte, die einem &ldquo;atomaren Typ&rdquo; angehören. Das sind z. B.:
</p>
<dl class="org-dl">
<dt>xs:untypedAtomic</dt><dd>Fallback für z. B. Attributwerte, wenn gegen kein Schema geprüft wird. D. h. der Prozessor sieht nur den Textinhalt &ldquo;2002-10-10T12:00:00-05:00Z&rdquo; und weiß nicht, dass er ihn z. B. als Datum (<code>xs:dateTime</code>) interpretieren soll.</dd>
<dt>xs:numeric</dt><dd>Vereinigungstyp aus <code>xs:double</code>, <code>xs:float</code> und <code>xs:decimal</code>. Also Zahlen.</dd>
<dt>xs:string</dt><dd>Eine Zeichenkette</dd>
<dt>xs:boolean</dt><dd>Ein Wahrheitswert. D. h. <code>true</code> oder <code>false</code></dd>
<dt>&#x2026;</dt><dd></dd>
</dl>
</div>
</div>
<div id="outline-container-org1e3cf03" class="outline-4">
<h4 id="org1e3cf03">Knoten</h4>
<div class="outline-text-4" id="text-org1e3cf03">
<p>
Es gibt sieben Arten von <a href="https://www.w3.org/TR/xpath-datamodel-31/#Node">Knoten</a>:
</p>
<ul class="org-ul">
<li><a href="https://www.w3.org/TR/xpath-datamodel-31/#DocumentNode">document</a></li>
<li><a href="https://www.w3.org/TR/xpath-datamodel-31/#ElementNode">element</a></li>
<li><a href="https://www.w3.org/TR/xpath-datamodel-31/#AttributeNode">attribute</a></li>
<li><a href="https://www.w3.org/TR/xpath-datamodel-31/#TextNode">text</a></li>
<li><a href="https://www.w3.org/TR/xpath-datamodel-31/#NamespaceNode">namespace</a></li>
<li><a href="https://www.w3.org/TR/xpath-datamodel-31/#ProcessingInstructionNode">processing instruction</a></li>
<li><a href="https://www.w3.org/TR/xpath-datamodel-31/#CommentNode">comment</a></li>
</ul>

<p>
Jeder Knoten hat eine eindeutige Identität die ihn von allen anderen Knoten im Baum unterscheidet, auch wenn die textuelle Repräsentation von zwei Knoten gleich aussehen mag.
</p>

<p>
Im folgenden Beispiel gibt es zwei mal das Attribut <code>tag="500"</code>. Es handelt sich dabei aber um zwei eindeutig unterscheidbare Knoten im Datenmodell.
</p>
<div class="org-src-container">
<pre class="src src-xml"><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">record</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">datafield</span> <span style="color: #268bd2;">tag</span>=<span style="color: #2aa198;">"500"</span> <span style="color: #268bd2;">ind1</span>=<span style="color: #2aa198;">" "</span> <span style="color: #268bd2;">ind2</span>=<span style="color: #2aa198;">" "</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
    <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">subfield</span> <span style="color: #268bd2;">code</span>=<span style="color: #2aa198;">"a"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span><span style="color: #556b72; background-color: #FDF6E3;">Erste Anmerkung</span><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">subfield</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">datafield</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">datafield</span> <span style="color: #268bd2;">tag</span>=<span style="color: #2aa198;">"500"</span> <span style="color: #268bd2;">ind1</span>=<span style="color: #2aa198;">" "</span> <span style="color: #268bd2;">ind2</span>=<span style="color: #2aa198;">" "</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
    <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">subfield</span> <span style="color: #268bd2;">code</span>=<span style="color: #2aa198;">"a"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span><span style="color: #556b72; background-color: #FDF6E3;">Zweite Anmerkung</span><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">subfield</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">datafield</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
<span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">record</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
</pre>
</div>

<p>
Der <i>Attributwert</i> <code>500</code> ist ein <code>atomicValue</code>. Dieser hat keine Identität. D. h. der Wert <code>500</code> ist in beiden Fällen derselbe.
</p>
</div>
</div>
<div id="outline-container-orgc479fbf" class="outline-4">
<h4 id="orgc479fbf">Funktionen</h4>
<div class="outline-text-4" id="text-orgc479fbf">
<p>
Siehe <a href="#xpath-funktionen">XPath &#x2013; Funktionen</a>
</p>
</div>
</div>
<div id="outline-container-orge89d017" class="outline-4">
<h4 id="orge89d017">Die Sequenz</h4>
<div class="outline-text-4" id="text-orge89d017">
<p>
Jede valide Instanz des Datenmodells ist eine Sequenz. Eine Sequenz ist eine geordnete Sammlung von null oder mehreren <code>items</code>. Jedes Item in einer Sequenz hat eine stabile Position (ermittelbar durch <code>position()</code>). Das erste Item in einer Sequenz ist auf Position 1 (nicht 0, wie in vielen anderen Programmiersprachen).
</p>

<p>
Eine Sequenz kann nicht in einer Sequenz enthalten sein. D. h. eine Kombination aus Sequenzen wird &ldquo;geplättet&rdquo;. D. h. <code>(1, (2, 3), (), (), 4)</code> wird zu <code>(1, 2, 3, 4)</code>
</p>

<p>
Ein einzelnes (&ldquo;singleton&rdquo;) item wird als eine Sequenz modelliert, die genau dieses eine item enthält.
</p>
</div>
</div>
<div id="outline-container-org52da86b" class="outline-4">
<h4 id="org52da86b"><a href="https://www.w3.org/TR/xpath-datamodel-31/#document-order">Document Order</a></h4>
<div class="outline-text-4" id="text-org52da86b">
<p>
Alle <a href="#org1e3cf03">Knoten</a> eines Dokuments haben eine absolute Reihenfolge. Diese Reihenfolge ist stabil und ändert sich nicht während einer Abfrage oder Transformation. Informell ist die Dokumentreihenfolge definiert als die Reihenfolge, in der die Knoten in einer XML-Serialisierung eines Dokuments erscheinen.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org4655578" class="outline-2">
<h2 id="org4655578">XPath</h2>
<div class="outline-text-2" id="text-org4655578">
</div>
<div id="outline-container-org40fee4b" class="outline-3">
<h3 id="org40fee4b">Pfadausdrücke</h3>
<div class="outline-text-3" id="text-org40fee4b">
<p>
Pfadausdrücke selektieren eine Sequenz von Items und geben diese zurück. Im Kontext der Programmierung heißt das, dass man nicht nur eine Liste der gefundenen Dinge bekommt, sondern tatsächlich die Dinge selbst, um etwas mit ihnen tun zu können.
</p>

<p>
Einzelne Schritte in einem Pfadausdruck werden durch <code>/</code> (den <code>path operator</code>) getrennt. Steht ein <code>/</code> am Anfang eines Ausdrucks, selektiert es den Wurzelknoten.
</p>

<p>
Nach dem Pfad-Operator <code>/</code> kommt ein &ldquo;Schritt&rdquo;. Ein solcher Schritt besteht aus der <b>Achse</b>, die die &ldquo;Bewegungsrichtung&rdquo; für den Schritt definiert und einem <b>Knotentest</b>. Ein Knotentest selektiert Knoten nach ihrer Art, ihrem Namen oder ihrem Typ.
</p>
</div>
<div id="outline-container-org943b254" class="outline-4">
<h4 id="org943b254">Achsen</h4>
</div>
<div id="outline-container-org5397a2e" class="outline-4">
<h4 id="org5397a2e">Prädikate</h4>
<div class="outline-text-4" id="text-org5397a2e">
<p>
Die Sequenz, die ein Schritt zurückgibt, kann durch <b>Prädikate</b> weiter gefiltert werden. Ein Prädikat wendet eine Prüfung auf jeden Knoten der Sequenz an und entfernt alle, bei denen die Prüfung <code>false</code> ergibt. Daher spricht man auch von Filterausdrücken.
</p>

<p>
Besipiel:
</p>
<div class="org-src-container">
<pre class="src src-xquery"><span style="color: #6c71c4; font-weight: bold;">/collection/record/datafield</span>[@tag=<span style="color: #2aa198;">"245"</span>]
</pre>
</div>

<p>
<code>/collection/record</code> erzeugt eine Sequenz mit allen <code>record</code>-Elementen. <code>/datafield</code> holt wiederum aus all diesen Records alle <code>datafields</code>. Das Prädikat <code>[@tag="245"]</code> lässt aber nur die durch, die ein Attribut <code>tag</code> mit dem Wert <code>245</code> haben.
</p>

<p>
Man kann auch mehrere Prädikate angeben. Diese werden von links nach rechts abgearbeitet:
</p>

<div class="org-src-container">
<pre class="src src-xquery"><span style="color: #6c71c4; font-weight: bold;">/collection/record/datafield</span>[@tag=<span style="color: #2aa198;">"245"</span>][@ind2!=<span style="color: #2aa198;">"0"</span>]
</pre>
</div>

<p>
Hier bekommen wir alle Titelfelder mit zu übergehenden Zeichen am Anfang. Man sieht hier auch, dass es zweckdienlich ist, zuerst die Prädikate anzugeben, die mehr ausfiltern (also kürzere Sequenzen durchlassen). Hätte man die Prädikate oben vertauscht würden zuerst alle <code>datafield</code> selektiert, die keinen zweiten Indikator &ldquo;0&rdquo; haben. Diese große Menge wiederum würde erst auf das Vorhandensein von <code>tag="245"</code> geprüft, während in der Version oben nur noch wenige elemente überhaupt die zweite Prüfung erreichen. Das kann gravierende Auswirkungen auf die Laufzeit einer Abfrage haben!
</p>
</div>
</div>
</div>
<div id="outline-container-orga59fe01" class="outline-3">
<h3 id="orga59fe01">Vergleichsausdrücke</h3>
<div class="outline-text-3" id="text-orga59fe01">
<p>
Xpath kennt zwei Arten von <a href="https://www.w3.org/TR/xpath-31/#id-comparisons">Vergleichen</a>: Value comparisons und general comparisons
</p>
</div>
<div id="outline-container-orgc54e00b" class="outline-4">
<h4 id="orgc54e00b"><a href="https://www.w3.org/TR/xpath-31/#id-value-comparisons">Value comparisons</a></h4>
<div class="outline-text-4" id="text-orgc54e00b">
<p>
Das ist, was man erwartet, wenn man an Vergleiche denkt. Hier werden zwei Werte verglichen, also z. B. zwei Strings, zwei Ganzzahlen, etc. Wenn auf einer Seite des Operators mehr als ein Item ist, führt das zu einem Fehler.
</p>

<p>
Die Operatoren sind:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Operator</th>
<th scope="col" class="org-left">Vergleich</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>eq</code></td>
<td class="org-left">gleich</td>
</tr>

<tr>
<td class="org-left"><code>ne</code></td>
<td class="org-left">ungleich</td>
</tr>

<tr>
<td class="org-left"><code>gt</code></td>
<td class="org-left">größer</td>
</tr>

<tr>
<td class="org-left"><code>ge</code></td>
<td class="org-left">größer gleich</td>
</tr>

<tr>
<td class="org-left"><code>lt</code></td>
<td class="org-left">kleiner</td>
</tr>

<tr>
<td class="org-left"><code>le</code></td>
<td class="org-left">kleiner gleich</td>
</tr>
</tbody>
</table>

<p>
Ergebnis des Vergleichs zweier Operanden ist ein Wahrheitswert. D. h. <code>2 eq 2</code> ist <code>true</code> <code>2 gt 2</code> ist <code>false</code>.
</p>
</div>
</div>
<div id="outline-container-org656201a" class="outline-4">
<h4 id="org656201a"><a href="https://www.w3.org/TR/xpath-31/#id-general-comparisons">General comparisons</a></h4>
<div class="outline-text-4" id="text-org656201a">
<p>
Bei general comparisons tritt wieder die Sequenz als Bestimmendes Merkmal des Datenmodells zutage.
Hier werden alle Werte der Sequenz auf der linken Seite mit allen Werten auf der rechten Seite verglichen. Wenn einer dieser Vergleiche erfolgreich ist, liefert die general comparison <code>true</code> zurück.
</p>

<p>
Die Operatoren:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Operator</th>
<th scope="col" class="org-left">Vergleich</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>=</code></td>
<td class="org-left">gleich</td>
</tr>

<tr>
<td class="org-left"><code>!=</code></td>
<td class="org-left">ungleich</td>
</tr>

<tr>
<td class="org-left"><code>&gt;</code></td>
<td class="org-left">größer</td>
</tr>

<tr>
<td class="org-left"><code>&gt;=</code></td>
<td class="org-left">größer gleich</td>
</tr>

<tr>
<td class="org-left"><code>&lt;</code></td>
<td class="org-left">kleiner</td>
</tr>

<tr>
<td class="org-left"><code>&lt;=</code></td>
<td class="org-left">kleiner gleich</td>
</tr>
</tbody>
</table>

<p>
Das ist sehr oft sehr praktisch. Z. B. kann man prüfen, ob eine Sequenz einen bestimmten Wert enthält: <code>2 = (1, 2, 3, 4)</code> ist <code>true</code>. Es ist aber mit Vorsicht zu genießen, weil <code>2 != (1, 2, 3, 4)</code> ist auch <code>true</code>. Warum?
</p>
</div>
</div>
</div>
<div id="outline-container-org08224a6" class="outline-3">
<h3 id="org08224a6"><a href="https://www.w3.org/TR/xpath-31/#id-logical-expressions">Logische Ausdrücke</a></h3>
<div class="outline-text-3" id="text-org08224a6">
<p>
Für logische Operationen gibt es in XPath die Operatoren <code>and</code> und <code>or</code> sowie die Funktion <code>not()</code>.
</p>

<p>
Diese Operatoren tun das, was man erwartet: Sie nehmen zwei Wahrheitswerte und geben einen Wahrheitswert zurück und folgen den Regeln der zweiwertigen Aussagen- oder Prädikatenlogik. Der Bequemlichkeit halber die üblichen Wahrheitstafeln:
</p>

<p>
Für <code>or</code>:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">OR</td>
<td class="org-left">true</td>
<td class="org-left">false</td>
</tr>

<tr>
<td class="org-left">true</td>
<td class="org-left">true</td>
<td class="org-left">true</td>
</tr>

<tr>
<td class="org-left">false</td>
<td class="org-left">true</td>
<td class="org-left">false</td>
</tr>
</tbody>
</table>

<p>
Für <code>and</code>:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">AND</td>
<td class="org-left">true</td>
<td class="org-left">false</td>
</tr>

<tr>
<td class="org-left">true</td>
<td class="org-left">true</td>
<td class="org-left">false</td>
</tr>

<tr>
<td class="org-left">false</td>
<td class="org-left">false</td>
<td class="org-left">false</td>
</tr>
</tbody>
</table>

<p>
Und <code>not()</code>
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">NOT</td>
<td class="org-left">true</td>
<td class="org-left">false</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">false</td>
<td class="org-left">true</td>
</tr>
</tbody>
</table>

<p>
Das heißt trivialerweise das <code>true() and true()</code> <code>true</code> ergibt, etc. Natürlich werden üblicherweise keine nackten Wahrheitswerte sondern quasi Aussagen überprüft, wie z. B. hier:
</p>

<div class="org-src-container">
<pre class="src src-xquery"><span style="color: #859900; font-weight: bold;">let</span> <span style="color: #268bd2;">$number1</span> := 3
<span style="color: #859900; font-weight: bold;">let</span> <span style="color: #268bd2;">$number2</span> := 7
<span style="color: #859900; font-weight: bold;">let</span> <span style="color: #268bd2;">$string1</span> := <span style="color: #2aa198;">"ogopogo"</span>
<span style="color: #859900; font-weight: bold;">return</span> <span style="color: #268bd2;">$number1</span> <span style="color: #859900; font-weight: bold;">gt</span> <span style="color: #268bd2;">$number2</span> <span style="color: #859900; font-weight: bold;">or</span> <span style="color: #b58900;">string-length</span>(<span style="color: #268bd2;">$string1</span>) <span style="color: #859900; font-weight: bold;">eq</span> <span style="color: #268bd2;">$number2</span> <span style="color: #859900; font-weight: bold;">and</span> <span style="color: #b58900;">string-length</span>(<span style="color: #268bd2;">$string1</span>) <span style="color: #859900; font-weight: bold;">mod</span> <span style="color: #268bd2;">$number1</span> <span style="color: #859900; font-weight: bold;">eq</span> 1
</pre>
</div>

<pre class="example">
true
</pre>
</div>
<div id="outline-container-org6109bb3" class="outline-4">
<h4 id="org6109bb3"><a href="https://www.w3.org/TR/xpath-31/#id-ebv">Effective Boolean Value</a></h4>
<div class="outline-text-4" id="text-org6109bb3">
<p>
Die Dinge, die mit logischen Operatoren verbunden sind, können nicht nur Wahrheitswerte sein. Oft verwendet man den &ldquo;effective boolean value&rdquo; (<code>EBV</code>). Ein sehr übliches Beispiel ist ein Prädikat, das auf das Vorhandensein eines Elements prüft, wie <code>datafield[subfield]</code>. Wir haben ja oben gelesen, dass ein Prädikat alle items einer Sequenz durchlässt, bei denen die Bedingung im Prädikat zutrifft, also <i>wahr</i> ist. Nun ist das Ergebnis von <code>subfield</code> nicht <code>true</code> oder <code>false</code> sondern eine (möglicherweise leere) Sequenz aller Subfelder. Trotzdem funktioniert es. Warum? Es gibt Regeln, nach denen ein <i>effektiver Wahrheitswert</i> gebildet wird:
</p>

<ol class="org-ol">
<li>leere Sequenz &rarr; <code>false</code></li>
<li>eine Sequenz deren erstes Item ein Knoten (<code>node</code>) ist &rarr; <code>true</code></li>
<li>bei Einzelwerten der Typen <code>xs:string</code>, <code>xs:anyURI</code>, <code>xs:untypedAtomic</code> und davon abgeleiteten Typen
<ol class="org-ol">
<li>wenn der Wert die Länge <code>0</code> hat &rarr; <code>false</code></li>
<li>sonst: <code>true</code></li>
</ol></li>
<li>bei Einzelwerten eines numerischen Typs (also Zahlen)
<ol class="org-ol">
<li>wenn der numerische Wert <code>NaN</code> oder <code>0</code> ist &rarr; <code>false</code></li>
<li>sonst: <code>true</code></li>
</ol></li>
<li>In allen anderen Fällen wirft der Prozessor einen Fehler.</li>
</ol>

<p>
Im Beispiel oben (<code>datafield[subfield]</code>) wird einer der Fälle 1. oder 2. zutreffen.
</p>
</div>
</div>
</div>
<div id="outline-container-xpath-funktionen" class="outline-3">
<h3 id="xpath-funktionen">Funktionen</h3>
<div class="outline-text-3" id="text-xpath-funktionen">
<p>
XPath und XQuery (und damit an bestimmten Stellen auch XSLT) haben eine umfangreiche Sammlung an Funktionen: <a href="https://www.w3.org/TR/xpath-functions-31/">https://www.w3.org/TR/xpath-functions-31/</a>
</p>

<p>
Diese sind hilfreich sowohl in Prädikaten (um eine Ergebnissequenz zu filtern) als auch zum Erstellen von modifizierten Ergebnissequenzen.
</p>
</div>
<div id="outline-container-org1d1b298" class="outline-4">
<h4 id="org1d1b298">Beispiele</h4>
<div class="outline-text-4" id="text-org1d1b298">
<p>
Einsatz in Prädikaten:
</p>

<div class="org-src-container">
<pre class="src src-xquery"><span style="color: #6c71c4; font-weight: bold;">/persons/person/name</span>[<span style="color: #b58900;">upper-case</span>(.) <span style="color: #859900; font-weight: bold;">eq</span> <span style="color: #2aa198;">"ELVIS"</span>]
</pre>
</div>

<p>
Findet alle Personen mit Namen &ldquo;Elvis&rdquo;, egal ob sie groß oder klein geschrieben sind. Die Funktion gibt immer den Eingabestring in Großbuchstaben zurück und wir prüfen gegen den String &ldquo;ELVIS&rdquo;.
</p>

<div class="org-src-container">
<pre class="src src-xquery"><span style="color: #6c71c4; font-weight: bold;">/persons/person/name</span>[<span style="color: #b58900;">upper-case</span>(.) <span style="color: #859900; font-weight: bold;">eq</span> <span style="color: #2aa198;">"Elvis"</span>]
</pre>
</div>

<p>
Was bekommen wir hier zurück?
</p>

<p>
Zur Konstruktion eines neuen Wertes:
</p>
<div class="org-src-container">
<pre class="src src-xml"><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span> <span style="color: #268bd2;">match</span>=<span style="color: #2aa198;">"datafield[@tag='245']/subfield[@code='a']"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">subfield</span> <span style="color: #268bd2;">code</span>=<span style="color: #2aa198;">"a"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
    <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">value-of</span> <span style="color: #268bd2;">select</span>=<span style="color: #2aa198;">"replace(., 'foo', 'bar')"</span> <span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">subfield</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
<span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
</pre>
</div>

<p>
Dieses Template ändert den Wert von <code>245$$a</code>, indem es die Zeichenkette <code>foo</code> gegen <code>bar</code> ersetzt       .
</p>
</div>
</div>
</div>
<div id="outline-container-org0de1e63" class="outline-3">
<h3 id="org0de1e63">Beispielabfragen</h3>
<div class="outline-text-3" id="text-org0de1e63">
<div class="org-src-container">
<pre class="src src-xquery"><span style="color: #6c71c4; font-weight: bold;">/collection/record</span> =&gt; <span style="color: #b58900;">count</span>()
</pre>
</div>

<pre class="example">
0
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdf9276c" class="outline-2">
<h2 id="orgdf9276c">XSLT</h2>
<div class="outline-text-2" id="text-orgdf9276c">
</div>
<div id="outline-container-orgd21ee97" class="outline-3">
<h3 id="orgd21ee97">Verarbeitungsmodell</h3>
<div class="outline-text-3" id="text-orgd21ee97">

<div id="orgc54144f" class="figure">
<p><img src="assets/img/kay2008_p45.png" alt="kay2008_p45.png" width="80%" />
</p>
<p><span class="figure-number">Figure 1: </span>Kay 2008, p. 45</p>
</div>
</div>
</div>
<div id="outline-container-orgf4b1c88" class="outline-3">
<h3 id="orgf4b1c88">Ablauf einer Transformation</h3>
<div class="outline-text-3" id="text-orgf4b1c88">
<p>
Danke ChatGPT!
</p>
</div>
<div id="outline-container-org9beeb8b" class="outline-4">
<h4 id="org9beeb8b">Eingabedaten</h4>
<div class="outline-text-4" id="text-org9beeb8b">
<ul class="org-ul">
<li>Eingabe besteht aus:
<ol class="org-ol">
<li>Dem Quell-XML-Dokument.</li>
<li>Dem XSLT-Stylesheet (ebenfalls XML-Struktur).</li>
</ol></li>
<li>Beides wird geparst und in den Speicher geladen</li>
</ul>
</div>
</div>
<div id="outline-container-org2c82e1e" class="outline-4">
<h4 id="org2c82e1e">Grundidee</h4>
<div class="outline-text-4" id="text-org2c82e1e">
<ul class="org-ul">
<li>XSLT folgt einem <b>deklarativen</b> Ansatz:
<ul class="org-ul">
<li>Es wird nicht Schritt-für-Schritt programmiert,
sondern Regeln (Templates) definieren, wie Knoten im Eingabe-XML
in Ausgabestrukturen transformiert werden.</li>
</ul></li>
<li>Die Verarbeitung basiert auf dem <b>Match-and-Apply</b>-Prinzip.
<ul class="org-ul">
<li>&ldquo;Wenn du diesen Input siehst, generiere Output, der so und so aussieht.&rdquo;</li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org5ded8d5" class="outline-4">
<h4 id="org5ded8d5">Ablauf im Detail</h4>
<div class="outline-text-4" id="text-org5ded8d5">
<ol class="org-ol">
<li><b>Parsing</b>
<ul class="org-ul">
<li>Das Quell-XML und das XSLT-Stylesheet werden beide zu
<b><b>XML-Baumstrukturen</b></b></li>
</ul></li>
<li><b>Initiales Template</b>
<ul class="org-ul">
<li>Optional kann man bestimmen, welches Template als erstes ausgeführt werden soll</li>
</ul></li>
<li><b>Template-Matching</b>
<ul class="org-ul">
<li>Der Prozessor sucht zu jedem aktuellen Eingabeknoten das am <b>beste passende</b>
Template (<code>&lt;xsl:template match="..."&gt;</code>).</li>
<li>Falls kein passendes Template existiert, greift die eingebaute Standardregel:
<ul class="org-ul">
<li>Für Texte: Ausgabe des Textinhalts.</li>
<li>Für Elemente: rekursives Anwenden auf Kindknoten.</li>
</ul></li>
</ul></li>
<li><b>Anweisungen im Template</b>
<ul class="org-ul">
<li>Wichtige Deklarationen:
<ul class="org-ul">
<li><code>xsl:apply-templates</code> → Verzweigt zu anderen Knoten</li>
<li><code>xsl:sequence</code> → Schreibt eine Sequenz von items in die Ausgabe</li>
<li><code>xsl:value-of</code> → Gibt Textwert eines Knotens aus</li>
<li><code>xsl:for-each</code> → Iteration über Knotenmengen</li>
<li><code>xsl:if</code> / <code>xsl:choose</code> → Bedingte Verarbeitung</li>
</ul></li>
</ul></li>
<li><b>Rekursive Verarbeitung</b>
<ul class="org-ul">
<li><code>xsl:apply-templates</code> löst wieder Template-Matching aus.</li>
<li>Dadurch kann der gesamte Eingabebaum Schritt für Schritt
transformiert werden.</li>
</ul></li>
<li><b>Ausgabe</b>
<ul class="org-ul">
<li>Der Ausgabebaum wird &ldquo;serialisiert&rdquo; (nicht notwendigerweise, aber in unseren Fällen immer)</li>
<li>XSLT erzeugt standardmäßig XML oder Text,
aber je nach <code>xsl:output</code> auch HTML oder andere Textformate.</li>
</ul></li>
</ol>
</div>
</div>
<div id="outline-container-orgb140f67" class="outline-4">
<h4 id="orgb140f67">Wichtige Eigenschaften</h4>
<div class="outline-text-4" id="text-orgb140f67">
<ul class="org-ul">
<li><b>Baumorientiert</b>: XSLT arbeitet immer mit Knotenbäumen, nicht mit Zeichenketten.</li>
<li><b>Deklarativ</b>: Man beschreibt <b>was</b> passieren soll, nicht <b>wie</b>.</li>
<li><b>Regelgesteuert</b>: Verarbeitung läuft über Template-Matching, nicht lineare Befehlsfolgen.</li>
<li><b>Deterministisch</b>: Bei gleichen Eingaben und Stylesheets immer gleiche Ausgaben.</li>
</ul>
</div>
</div>
<div id="outline-container-org53f3d4a" class="outline-4">
<h4 id="org53f3d4a">Beispielablauf</h4>
<div class="outline-text-4" id="text-org53f3d4a">
<p>
Gegeben:
</p>
<div class="org-src-container">
<pre class="src src-xml">   <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">root</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
     <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">item</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span><span style="color: #556b72; background-color: #FDF6E3;">A</span><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">item</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
     <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">item</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span><span style="color: #556b72; background-color: #FDF6E3;">B</span><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">item</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
   <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">root</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
</pre>
</div>

<p>
Stylesheet:
</p>
<div class="org-src-container">
<pre class="src src-xml">   <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">stylesheet</span> <span style="color: #d33682; font-style: italic;">xmlns</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #268bd2;">xsl</span>=<span style="color: #2aa198;">"http://www.w3.org/1999/XSL/Transform"</span> <span style="color: #268bd2;">version</span>=<span style="color: #2aa198;">"1.0"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
     <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span> <span style="color: #268bd2;">match</span>=<span style="color: #2aa198;">"/"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
       <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">html</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;&lt;</span><span style="color: #b58900;">body</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">apply-templates</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">body</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">html</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
     <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>

     <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span> <span style="color: #268bd2;">match</span>=<span style="color: #2aa198;">"item"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
       <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">p</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">value-of</span> <span style="color: #268bd2;">select</span>=<span style="color: #2aa198;">"."</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">p</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
     <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
   <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">stylesheet</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
</pre>
</div>

<p>
Ablauf:
</p>
<ol class="org-ol">
<li>Start: Template <code>/</code> → Erzeugt <code>&lt;html&gt;&lt;body&gt;…&lt;/body&gt;&lt;/html&gt;</code>.</li>
<li><code>xsl:apply-templates</code> → Findet <code>&lt;item&gt;</code>-Elemente.</li>
<li>Für jedes <code>&lt;item&gt;</code>: passendes Template erzeugt <code>&lt;p&gt;Inhalt&lt;/p&gt;</code>.</li>
<li><p>
Ausgabe:
</p>
<div class="org-src-container">
<pre class="src src-html">      &lt;<span style="color: #b58900;">html</span>&gt;&lt;<span style="color: #b58900;">body</span>&gt;&lt;<span style="color: #b58900;">p</span>&gt;A&lt;/<span style="color: #b58900;">p</span>&gt;&lt;<span style="color: #b58900;">p</span>&gt;B&lt;/<span style="color: #b58900;">p</span>&gt;&lt;/<span style="color: #b58900;">body</span>&gt;&lt;/<span style="color: #b58900;">html</span>&gt;
</pre>
</div></li>
</ol>
</div>
</div>
<div id="outline-container-org17f746a" class="outline-4">
<h4 id="org17f746a">Ablaufdiagramm</h4>
<div class="outline-text-4" id="text-org17f746a">
<div class="org-src-container">
<pre class="src src-ascii">Quell-XML
   │
   ▼
Parsen → XML-Baum
   │
   │ + XSLT-Stylesheet → Parsen → Template-Baum
   ▼
Start-Template (match="/")
   │
   ▼
Template-Matching + Ausführung (apply-templates, value-of, etc.)
   │
   ▼
Ausgabebaum
   │
   ▼
Serialisierung → Endausgabe (XML / HTML / Text)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orga057027" class="outline-3">
<h3 id="orga057027">Wichtige Deklarationen und Anweisungen</h3>
<div class="outline-text-3" id="text-orga057027">
</div>
<div id="outline-container-orgd526838" class="outline-4">
<h4 id="orgd526838"><a href="https://www.w3.org/TR/xslt-30/#rules">xsl:template</a></h4>
<div class="outline-text-4" id="text-orgd526838">
<p>
<code>xsl:template</code> ist die wohl wichtigste Deklaration in XSLT. Das <code>&lt;xsl:template&gt;</code> element muss entweder ein <code>match</code> und/oder ein <code>name</code>-Attribut haben.
</p>
</div>
<ul class="org-ul">
<li><a id="orgc380ba5"></a>match-templates<br />
<div class="outline-text-5" id="text-orgc380ba5">
<p>
<code>xsl:template</code>-Deklarationen mit einem <code>match</code>-Attribute nennt man gemeinhin &ldquo;Match-Template&rdquo; oder &ldquo;Matching-Template&rdquo;. Der Wert von <code>@match</code> enthält ein <a href="https://www.w3.org/TR/xslt-30/#patterns">pattern</a>. Wenn ein Knoten dieses Pattern &ldquo;matcht&rdquo;, also das Pattern auf einen Knoten zutrifft, wird der <a href="https://www.w3.org/TR/xslt-30/#sequence-constructors">Sequenz-Konstruktor</a> (also der Inhalt des <code>xsl:template</code>-Elements) evaluiert und die sich daraus ergebende Sequenz in den Ausgabebaum geschrieben.
</p>
</div>
</li>
<li><a id="orgcc8377d"></a>named templates<br />
<div class="outline-text-5" id="text-orgcc8377d">
<p>
Wenn ein Template ein <code>name</code>-Attribut hat, kann es von anderen Templates aus mit der <code>xsl:call-template name="name-des-templates" /&gt;</code>-Anweisung aufgerufen werden. Das Template wird dann im aufrufenden Kontext ausgeführt:
</p>

<div class="org-src-container">
<pre class="src src-xml"><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span> <span style="color: #268bd2;">match</span>=<span style="color: #2aa198;">"record"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">call-template</span> <span style="color: #268bd2;">name</span>=<span style="color: #2aa198;">"copy-current-context-node"</span> <span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
<span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>

<span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span> <span style="color: #268bd2;">name</span>=<span style="color: #2aa198;">"copy-current-context-node"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">sequence</span> <span style="color: #268bd2;">select</span>=<span style="color: #2aa198;">"."</span> <span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
<span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
</pre>
</div>

<p>
Im obigen Beispiel wird der Kontexknoten des aufrufenden Templates (also der gematchte <code>record</code>) in den Ausgebebaum kopiert.
</p>
</div>
</li>
</ul>
</div>
<div id="outline-container-org7f26a9a" class="outline-4">
<h4 id="org7f26a9a">Entscheidungen treffen: <code>xsl:if</code> und <code>xsl:choose</code></h4>
<div class="outline-text-4" id="text-org7f26a9a">
<p>
Manche Anweisungen sollen nur dann ausgeführt werden, wenn bestimmte Bedingungen gegeben sind. Hier der Link zur Spezifikation:<a href="https://www.w3.org/TR/xslt-30/#conditionals">Contitional Processing</a>
</p>
</div>
<ul class="org-ul">
<li><a id="orgc856144"></a><a href="https://www.w3.org/TR/xslt-30/#xsl-if">xsl:if</a><br />
<div class="outline-text-5" id="text-orgc856144">
<p>
Die Anweisung <code>xsl:if</code> hat ein verpflichtendes Attribut <code>@test</code>. Ist der effektive Wahrheitswert des Ausdrucks in diesem Attribut wahr, wird der in <code>xsl:if</code> enthaltene Sequenz-Konstruktor evaluiert und die daraus resultierende Sequenz wird zurückgegeben. Andernfalls wird der Sequenz-Konstruktor nicht evaluiert und der Rückgabewert ist die leere Sequenz.
</p>

<p>
<b>Beispiel:</b>
</p>
<div class="org-src-container">
<pre class="src src-xml"><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span> <span style="color: #268bd2;">match</span>=<span style="color: #2aa198;">"record"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #96A7A9; font-style: italic;">&lt;!-- </span><span style="color: #96A7A9; font-style: italic;">...</span><span style="color: #96A7A9; font-style: italic;"> --&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">if</span> <span style="color: #268bd2;">test</span>=<span style="color: #2aa198;">"not(controlfield[@tag='007'])"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
    <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">controlfield</span> <span style="color: #268bd2;">tag</span>=<span style="color: #2aa198;">"007"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span><span style="color: #556b72; background-color: #FDF6E3;">tu</span><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">controlfield</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">if</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #96A7A9; font-style: italic;">&lt;!-- </span><span style="color: #96A7A9; font-style: italic;">...</span><span style="color: #96A7A9; font-style: italic;"> --&gt;</span>
<span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
</pre>
</div>
</div>
</li>
<li><a id="org328444d"></a><a href="https://www.w3.org/TR/xslt-30/#xsl-choose">xsl:choose</a><br />
<div class="outline-text-5" id="text-org328444d">
<p>
Sollen unter verschiedenen Bedingungen verschiedene Dinge passieren, ist die <code>xsl:choose</code>-Anweisung das Werkzeug der Wahl. Das <code>xsl:choose</code>-Element muss mindestens ein <code>xsl:when</code> element enthalten.
</p>

<p>
<code>xsl:when</code> hat das verpflichtende Attribut <code>@test</code>. Ist der effektive Wahrheitswert des Ausdrucks in diesem Attribut wahr, wird der enthaltene Sequenz-Konstruktor evaluiert und die daraus resultierende Sequenz wird zurückgegeben. Ist er falsch, wird die nächste <code>xsl:when</code>-Anweisung ausgeführt.
</p>

<p>
Das Ergebnis von <code>xsl:choose</code> is das Ergebnis der ersten zutreffenden <code>xsl:when</code>-Anweisung. Nach der ersten zutreffenden <code>xsl:choose</code>-Anweisung werden keine weiteren Anweisungen verarbeitet.
</p>

<p>
Trifft keines der <code>@test</code>-Attribute zu, wird der Sequenz-Konstruktor in der <code>xsl:otherwise</code>-Anweisung evaluiert. Trifft kein <code>@test</code>-Attribut zu und es gibt kein <code>xsl:otherwise</code>, ist das Ergebnis von <code>xsl:choose</code> die leere Sequenz.
</p>

<p>
<b>Beispiel:</b>
</p>
<div class="org-src-container">
<pre class="src src-xml"><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">choose</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">when</span> <span style="color: #268bd2;">test</span>=<span style="color: #2aa198;">"contains(basket, 'orange')"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span><span style="color: #556b72; background-color: #FDF6E3;">juice</span><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">when</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">when</span> <span style="color: #268bd2;">test</span>=<span style="color: #2aa198;">"contains(basket, 'apple')"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span><span style="color: #556b72; background-color: #FDF6E3;">pie</span><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">when</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">otherwise</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span><span style="color: #556b72; background-color: #FDF6E3;">grub</span><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">otherwise</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
<span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">choose</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
</pre>
</div>

<ul class="org-ul">
<li>Wenn <code>basket</code> im obigen Beisiel <code>"kiwi orange apple banana"</code> ist, ist das Ergebnis <code>"juice"</code>.</li>
<li>Wenn <code>basket</code> im obigen Beisiel <code>"kiwi lemon apple banana "</code> ist, ist das Ergebnis <code>"pie"</code>.</li>
<li>Wenn <code>basket</code> im obigen Beisiel <code>"kiwi lemon pear banana "</code> ist, ist das Ergebnis <code>"grub"</code>.</li>
</ul>
</div>
</li>
</ul>
</div>
<div id="outline-container-org50d0721" class="outline-4">
<h4 id="org50d0721"><a href="https://www.w3.org/TR/xslt-30/#copy-of">xsl:copy-of</a> und <a href="https://www.w3.org/TR/xslt-30/#constructing-sequences">xsl:sequence</a></h4>
<div class="outline-text-4" id="text-org50d0721">
<p>
<code>xsl:copy-of</code> und <code>xsl:sequence</code> geben eine Sequenz an Knoten zurück, die durch das <code>@select</code>-Attribut definiert werden. In <code>xsl:sequence</code> kann man statt dem <code>@select</code> auch einen Sequenz-Kostruktur verwenden.
</p>

<p>
Der Effekt von beiden Anweisungen ist den meisten Fällen der gleiche. <code>xsl:copy-of</code> erstellt allerdings eine tiefe Kopie der selektierten Knoten. <code>xsl:sequence</code> gibt auch vorhandene Knoten zurück, was effizienter sein kann.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-orgf2880fe" class="outline-2">
<h2 id="orgf2880fe">Starten von Transformationen und Tests</h2>
<div class="outline-text-2" id="text-orgf2880fe">
</div>
<div id="outline-container-org28185a6" class="outline-3">
<h3 id="org28185a6">Eine Transformation starten</h3>
<div class="outline-text-3" id="text-org28185a6">
<p>
Diese Anleitung geht davon aus, dass es in <code>$PATH</code> das Script <code>saxon-xslt</code> gibt und dieses ausführbar ist. Dieses wird folgendermaßen aufgerufen:
</p>

<div class="org-src-container">
<pre class="src src-shell">saxon-xslt SOURCE-FILE XSLT-STYLESHEET
</pre>
</div>

<p>
Damit wird <code>SOURCE-FILE</code> entsprechend <code>XSLT-STYLESHEET</code> transformiert und das Ergebnis auf der Konsole (auf <code>stdout</code>) ausgegeben. Will man das Ergebnis in einer Datei speichern, nutzt man die output redirection der shell:
</p>

<div class="org-src-container">
<pre class="src src-shell">saxon-xslt marc_records.xml convert.xsl &gt; marc_records_converted.xml
</pre>
</div>
</div>
</div>
<div id="outline-container-org7542027" class="outline-3">
<h3 id="org7542027">Tests laufen lassen</h3>
<div class="outline-text-3" id="text-org7542027">
<p>
Diese Anleitung geht davon aus, dass es in <code>$PATH</code> das Script <code>xspec.sh</code> gibt und dieses ausführbar ist. Der Aufruf ist simpel:
</p>

<div class="org-src-container">
<pre class="src src-shell">xspec.sh XSPEC-FILE
</pre>
</div>

<p>
Das heißt, wenn die Tests in der Datei <code>tests/tests.xspec</code> wohnen:
</p>

<div class="org-src-container">
<pre class="src src-shell">xspec.sh tests/test.xspec
</pre>
</div>

<p>
XSpec gibt die Ergebnisse der Tests auf der Konsole aus. Ein detaillierter Testbericht ist als HTML-Datei verfügbar. Wo diese zu finden ist, steht am Ende der Konsolenausgabe.
</p>
</div>
</div>
</div>
<div id="outline-container-org8a4310b" class="outline-2">
<h2 id="org8a4310b">Beispiele</h2>
<div class="outline-text-2" id="text-org8a4310b">
</div>
<div id="outline-container-org0c6cf67" class="outline-3">
<h3 id="org0c6cf67">Text in Subfeld ändern</h3>
<div class="outline-text-3" id="text-org0c6cf67">
<p>
Wir wollen Zahlen am Ende von <code>9707#$$d</code> entfernen.
</p>

<div class="org-src-container">
<pre class="src src-xml"><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span> <span style="color: #268bd2;">match</span>=<span style="color: #2aa198;">"datafield[@tag='970']
                                [@ind1='7']
                                [@ind2=' ']
                                /subfield[@code='d'][matches(., '^IV-SCAN[0-9]+$')]"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">subfield</span> <span style="color: #268bd2;">code</span>=<span style="color: #2aa198;">"d"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span><span style="color: #556b72; background-color: #FDF6E3;">{replace(., "[0-9]+$", "")}</span><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">subfield</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
<span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
</pre>
</div>

<p>
Dieses Template matcht auf Subfelder <code>d</code> in <code>9707#</code>, wenn diese mit dem Muster <code>^IV-SCAN[0-9]+$</code> entsprechen. D. h. wenn sie mit <code>IV-SCAN</code> beginnen, direkt gefolgt von einer oder mehreren Ziffern. Danach kommt nichts mehr.
</p>

<p>
Aus
</p>
<div class="org-src-container">
<pre class="src src-xml"><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">datafield</span> <span style="color: #268bd2;">tag</span>=<span style="color: #2aa198;">"970"</span> <span style="color: #268bd2;">ind1</span>=<span style="color: #2aa198;">"7"</span> <span style="color: #268bd2;">ind2</span>=<span style="color: #2aa198;">" "</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">subfield</span> <span style="color: #268bd2;">code</span>=<span style="color: #2aa198;">"d"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span><span style="color: #556b72; background-color: #FDF6E3;">IV-SCAN9</span><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">subfield</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">subfield</span> <span style="color: #268bd2;">code</span>=<span style="color: #2aa198;">"d"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span><span style="color: #556b72; background-color: #FDF6E3;">IV-SCAN88</span><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">subfield</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">subfield</span> <span style="color: #268bd2;">code</span>=<span style="color: #2aa198;">"d"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span><span style="color: #556b72; background-color: #FDF6E3;">Nicht IV-SCAN1</span><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">subfield</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">subfield</span> <span style="color: #268bd2;">code</span>=<span style="color: #2aa198;">"d"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span><span style="color: #556b72; background-color: #FDF6E3;">IV-SCAN42L&#214;SCHTMANNICHT</span><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">subfield</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">subfield</span> <span style="color: #268bd2;">code</span>=<span style="color: #2aa198;">"a"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span><span style="color: #556b72; background-color: #FDF6E3;">Testfeld</span><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">subfield</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
<span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">datafield</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
</pre>
</div>
<p>
wird dann
</p>
<div class="org-src-container">
<pre class="src src-xml"><span style="color: #556b72; background-color: #FDF6E3;">&lt;?</span><span style="color: #859900; font-weight: bold;">xml</span> <span style="color: #35a69c; font-style: italic;">version="1.0"</span><span style="color: #556b72; background-color: #FDF6E3;">?&gt;</span>
<span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">datafield</span> <span style="color: #268bd2;">tag</span>=<span style="color: #2aa198;">"970"</span> <span style="color: #268bd2;">ind1</span>=<span style="color: #2aa198;">"7"</span> <span style="color: #268bd2;">ind2</span>=<span style="color: #2aa198;">" "</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">subfield</span> <span style="color: #268bd2;">code</span>=<span style="color: #2aa198;">"d"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span><span style="color: #556b72; background-color: #FDF6E3;">IV-SCAN</span><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">subfield</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">subfield</span> <span style="color: #268bd2;">code</span>=<span style="color: #2aa198;">"d"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span><span style="color: #556b72; background-color: #FDF6E3;">IV-SCAN</span><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">subfield</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">subfield</span> <span style="color: #268bd2;">code</span>=<span style="color: #2aa198;">"d"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span><span style="color: #556b72; background-color: #FDF6E3;">Nicht IV-SCAN1</span><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">subfield</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">subfield</span> <span style="color: #268bd2;">code</span>=<span style="color: #2aa198;">"d"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span><span style="color: #556b72; background-color: #FDF6E3;">IV-SCAN42L&#214;SCHTMANNICHT</span><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">subfield</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">subfield</span> <span style="color: #268bd2;">code</span>=<span style="color: #2aa198;">"a"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span><span style="color: #556b72; background-color: #FDF6E3;">Testfeld</span><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">subfield</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
<span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">datafield</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orga0a3c96" class="outline-3">
<h3 id="orga0a3c96">337 aus 338 generieren</h3>
<div class="outline-text-3" id="text-orga0a3c96">
<p>
Drools-Implementierung: <a href="https://gitlab.obvsg.at/AlmaConfig/droolsConfig/-/blob/master/rules/normalizationRules/KATA/src/KATA-004-a33Xb.src?ref_type=heads">https://gitlab.obvsg.at/AlmaConfig/droolsConfig/-/blob/master/rules/normalizationRules/KATA/src/KATA-004-a33Xb.src?ref_type=heads</a>
</p>

<p>
Also so eine Regel für jeden möglichen Code in <code>338##$$b</code> (11 Stück):
</p>
<div class="org-src-container">
<pre class="src src-drools"><span style="color: #859900; font-weight: bold;">rule</span> <span style="color: #2aa198;">"KATA-004-a33Xb: generate 337 b.s from 338 b.s*"</span>
    <span style="color: #96A7A9; font-style: italic;">/*
    name: KATA-004-a33Xb
    fields: 337
    definition: generate 337 b.s from 338 b.s*
    note:
    */</span>

    <span style="color: #859900; font-weight: bold;">when</span>
        exists <span style="color: #2aa198;">"338.b.s*"</span> and <span style="color: #d33682; font-style: italic;">not</span> exists <span style="color: #2aa198;">"337.b.s"</span>
    <span style="color: #859900; font-weight: bold;">then</span>
        addField <span style="color: #2aa198;">"337.b.s"</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>

<p>
XSLT-Umsetzung:
</p>
<div class="org-src-container">
<pre class="src src-xml"><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span> <span style="color: #268bd2;">match</span>=<span style="color: #2aa198;">"datafield[@tag='338']/subfield[@code='b']"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #96A7A9; font-style: italic;">&lt;!-- </span><span style="color: #96A7A9; font-style: italic;">Das 338 $$b selbst &#252;bernehmen (sonst verschwindet es)</span><span style="color: #96A7A9; font-style: italic;"> --&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">sequence</span> <span style="color: #268bd2;">select</span>=<span style="color: #2aa198;">"."</span> <span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>

  <span style="color: #96A7A9; font-style: italic;">&lt;!-- </span><span style="color: #96A7A9; font-style: italic;">Falls es keine 337 gibt, erzeuge eine mit dem ersten Zeichen von 338 $$b in $$b.</span><span style="color: #96A7A9; font-style: italic;"> --&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">if</span> <span style="color: #268bd2;">test</span>=<span style="color: #2aa198;">"not(../../datafield[@tag='337'])"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
    <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">datafield</span> <span style="color: #268bd2;">tag</span>=<span style="color: #2aa198;">"337"</span> <span style="color: #268bd2;">ind1</span>=<span style="color: #2aa198;">" "</span> <span style="color: #268bd2;">ind2</span>=<span style="color: #2aa198;">" "</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
      <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">subfield</span> <span style="color: #268bd2;">code</span>=<span style="color: #2aa198;">"b"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span><span style="color: #556b72; background-color: #FDF6E3;">{substring(., 1, 1)}</span><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">subfield</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
    <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">datafield</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">if</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
<span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org8867e78" class="outline-3">
<h3 id="org8867e78">Bindestriche aus ISBN in 020 entfernen</h3>
<div class="outline-text-3" id="text-org8867e78">
<p>
Drools-Regel:
</p>
<div class="org-src-container">
<pre class="src src-drools"><span style="color: #859900; font-weight: bold;">rule</span> <span style="color: #2aa198;">"KATA-014-ISBN: delete hyphens in 020 SF-a"</span>
    <span style="color: #96A7A9; font-style: italic;">/*
    name: KATA-014-ISBN
    fields: 020
    definition: Entferne die Bindestriche aus ISBNs in 020, 77X, 78X.
    note:
    */</span>

    <span style="color: #859900; font-weight: bold;">when</span>
        exists <span style="color: #2aa198;">"020.a"</span> or exists <span style="color: #2aa198;">"77*.z"</span> or exists <span style="color: #2aa198;">"78*.z"</span>
    <span style="color: #859900; font-weight: bold;">then</span>
        replaceContents <span style="color: #2aa198;">"020.a.-"</span> with <span style="color: #2aa198;">""</span>
        replaceContents <span style="color: #2aa198;">"77*.z.-"</span> with <span style="color: #2aa198;">""</span>
        replaceContents <span style="color: #2aa198;">"78*.z.-"</span> with <span style="color: #2aa198;">""</span>
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>

<p>
XSLT
</p>
<div class="org-src-container">
<pre class="src src-xml"><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span> <span style="color: #268bd2;">match</span>=<span style="color: #2aa198;">"datafield[@tag=('020', '773', 'TBD')]/subfield[@code=('a', 'z')]"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">subfield</span> <span style="color: #268bd2;">code</span>=<span style="color: #2aa198;">"{@code}"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span><span style="color: #556b72; background-color: #FDF6E3;">{replace(., "-", "")}</span><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">subfield</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
<span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org1f9404f" class="outline-3">
<h3 id="org1f9404f">Feld 655</h3>
<div class="outline-text-3" id="text-org1f9404f">
<p>
Setze den zweiten Indikator auf &rsquo;7&rsquo;, wenn es ein nicht-leeres <code>$$2</code> gibt.
</p>
<div class="org-src-container">
<pre class="src src-drools"><span style="color: #859900; font-weight: bold;">rule</span> <span style="color: #2aa198;">"KATA-074-655ind2: change second indicator to 7, if exists Sf2"</span>
    <span style="color: #96A7A9; font-style: italic;">/*
    name: KATA-074-655ind2
    fields: 655
    definition: &#196;ndere `655 @ind2` auf `7` wenn es SF2 gibt.
    note:
    */</span>
    <span style="color: #859900; font-weight: bold;">when</span>
        exists <span style="color: #2aa198;">"655.2"</span>
    <span style="color: #859900; font-weight: bold;">then</span>
        changeFirstIndicator <span style="color: #2aa198;">"655"</span> to <span style="color: #2aa198;">" "</span>
        changeSecondIndicator <span style="color: #2aa198;">"655"</span> to <span style="color: #2aa198;">"7"</span> if (exists <span style="color: #2aa198;">"655.2"</span>)
<span style="color: #859900; font-weight: bold;">end</span>
</pre>
</div>

<p>
XSLT
</p>
<div class="org-src-container">
<pre class="src src-xml"><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span> <span style="color: #268bd2;">match</span>=<span style="color: #2aa198;">"datafield[@tag='655'][subfield[@code='2']/text()]/@ind2"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">attribute</span> <span style="color: #268bd2;">name</span>=<span style="color: #2aa198;">"ind2"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span><span style="color: #556b72; background-color: #FDF6E3;">7</span><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">attribute</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
<span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org11e570e" class="outline-2">
<h2 id="org11e570e">Übungen</h2>
<div class="outline-text-2" id="text-org11e570e">
</div>
<div id="outline-container-org365f8ae" class="outline-3">
<h3 id="org365f8ae">ex01: Felder löschen</h3>
<div class="outline-text-3" id="text-org365f8ae">
</div>
<div id="outline-container-org7c7d29a" class="outline-4">
<h4 id="org7c7d29a">ex01_01: Lösche das Feld <code>998</code></h4>
</div>
<div id="outline-container-orgd360288" class="outline-4">
<h4 id="orgd360288">ex01_02: Lösche <code>77308$$9</code></h4>
</div>
</div>
<div id="outline-container-org6d4d2cb" class="outline-3">
<h3 id="org6d4d2cb">ex02: Felder nach inhaltlichen Kriterien löschen</h3>
<div class="outline-text-3" id="text-org6d4d2cb">
</div>
<div id="outline-container-orgc51cf3b" class="outline-4">
<h4 id="orgc51cf3b">ex02_01:</h4>
<div class="outline-text-4" id="text-orgc51cf3b">
<p>
Wir wollen alle Felder 500 löschen, die in <code>$$a</code> den Text <code>foo</code> enthalten.
</p>
</div>
</div>
<div id="outline-container-org38f0f21" class="outline-4">
<h4 id="org38f0f21">ex02_02:</h4>
<div class="outline-text-4" id="text-org38f0f21">
<p>
Wir wollen alle Felder 500 löschen, die in <code>$$a</code> den Text <code>foo</code>, aber nicht den Text <code>bar</code> enthalten.
</p>
</div>
</div>
<div id="outline-container-orgba561ea" class="outline-4">
<h4 id="orgba561ea">ex02_03:</h4>
<div class="outline-text-4" id="text-orgba561ea">
<p>
Wir wollen alle Felder 500 löschen, die in <code>$$a</code> den Text <code>foo</code> direkt gefolgt von einer beliebig langen Zahl enthalten. Also <code>foo1</code>, <code>foo667</code>, <code>foo00000000000000001</code>.
</p>
</div>
</div>
</div>
<div id="outline-container-org4450d24" class="outline-3">
<h3 id="org4450d24">ex03: Felder umbenennen</h3>
<div class="outline-text-3" id="text-org4450d24">
</div>
<div id="outline-container-orga6d4535" class="outline-4">
<h4 id="orga6d4535">ex03_02: 653 bedingungslos nach 982 verschieben</h4>
<div class="outline-text-4" id="text-orga6d4535">
</div>
<ul class="org-ul">
<li><a id="org7a41e00"></a>Nicht vergessen: <code>$$9LOCAL</code> hinzufügen!<br /></li>
</ul>
</div>
<div id="outline-container-org3a06108" class="outline-4">
<h4 id="org3a06108">ex03_02: Hochschulschriftenvermerk von <code>500##</code> nach <code>502##</code> verschieben</h4>
</div>
</div>
<div id="outline-container-org1d07f92" class="outline-3">
<h3 id="org1d07f92">ex04: Feldinhalte ändern</h3>
<div class="outline-text-3" id="text-org1d07f92">
</div>
<div id="outline-container-org8f428cd" class="outline-4">
<h4 id="org8f428cd">ex04_01: Falsche GND-Nummer in 655</h4>
<div class="outline-text-4" id="text-org8f428cd">
<p>
Eine Zeitlang war in der CV-Liste für den Term &ldquo;Backbuch&rdquo; eine falsche GND-ID, nämlich <code>(DE-588)7502992-3</code>. Richtig wäre <code>(DE-588)1071926306</code>.
</p>
<ul class="org-ul">
<li>Stylesheet: <a href="exercises/ex04/ex04_01.xsl">exercises/ex04/ex04_01.xsl</a></li>
<li>Tests: <a href="exercises/ex04/ex04_01.xspec">exercises/ex04/ex04_01.xspec</a></li>
</ul>

<p>
Im Folgenden werden drei mögliche Lösungen vorgestellt. Sie bringen das gleiche Ergebnis. Welche man bevorzugt, ist eine Frage des Stils. Man sollte eine Lösung wählen, von der man glaubt, dass sie die Intention gut darstellt, wenn man den Code später wieder liest.
</p>
</div>
<ul class="org-ul">
<li><a id="orgd58d6e5"></a><code>xsl:choose</code><br />
<div class="outline-text-5" id="text-orgd58d6e5">
<p>
Das Template hier matcht auf Subfeld 0 und erst in der Template-Rule wird via <code>xsl:choose</code> entschieden, ob die Nummer falsch ist. Wenn nicht, wird das Subfeld unverändert in die Ausgabe geschrieben:
</p>

<div class="org-src-container">
<pre class="src src-xml"><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span> <span style="color: #268bd2;">match</span>=<span style="color: #2aa198;">"datafield[@tag='655']
                              [subfield[@code='a'][.='Backbuch']]
                     /subfield[@code='0']"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">choose</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
    <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">when</span> <span style="color: #268bd2;">test</span>=<span style="color: #2aa198;">"not(.='(DE-588)1071926306')"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
      <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">subfield</span> <span style="color: #268bd2;">code</span>=<span style="color: #2aa198;">"0"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span><span style="color: #556b72; background-color: #FDF6E3;">(DE-588)1071926306</span><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">subfield</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
    <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">when</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
    <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">otherwise</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
      <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">sequence</span> <span style="color: #268bd2;">select</span>=<span style="color: #2aa198;">"."</span> <span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
    <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">otherwise</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">choose</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
<span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
</pre>
</div>

<p>
Sehr explizit, aber auch länglich.
</p>
</div>
</li>
<li><a id="org988b8e1"></a>Im <code>match</code> auf die falsche Nummer prüfen<br />
<div class="outline-text-5" id="text-org988b8e1">
<p>
Hier wird gleich im <code>mach</code> auf die falsche Nummer geprüft. Daher ist es nicht notwendig, sich um Felder mit der richtigen Nummer zu kümmern &#x2013; diese werden nicht gematcht und von diesem Template dementsprechend nicht betrachtet.
</p>

<p>
Durch diese Vorgehensweise ist in der Template-Rule keinerlei Prüfung notwendig und daher enthält sie nur das literale Ausgabeelement.
</p>

<div class="org-src-container">
<pre class="src src-xml"><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span> <span style="color: #268bd2;">match</span>=<span style="color: #2aa198;">"datafield[@tag='655']
                               subfield[@code='a'][.='Backbuch']]
                     /subfield[@code='0']
                              [.='(DE-588)7502992-3']"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #b58900;">subfield</span> <span style="color: #268bd2;">code</span>=<span style="color: #2aa198;">"0"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span><span style="color: #556b72; background-color: #FDF6E3;">(DE-588)1071926306</span><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #b58900;">subfield</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
<span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
</pre>
</div>

<p>
Kurz und knackig. Die Logik liegt im <code>match</code>, was bei komplexeren Sachverhalten unübersichtlich werden kann.
</p>
</div>
</li>
<li><a id="org0aee32b"></a>Im <code>match</code> auf die falsche Nummer prüfen und direkt den Textknoten bearbeiten<br />
<div class="outline-text-5" id="text-org0aee32b">
<p>
Die Prüfung ist gleich wie in der vorigen Lösung, nur dass hier nicht auf das Subfeld sondern direkt auf den Textknoten gematcht wird.
</p>

<p>
Der Text wird mit <code>xsl:text</code> generiert. Würde man in direkt ins <code>xsl:template</code>-Element schrieben, würde er auch Zeilenumbrüche etc. enthalten.
</p>

<div class="org-src-container">
<pre class="src src-xml"><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span> <span style="color: #268bd2;">match</span>=<span style="color: #2aa198;">"datafield[@tag='655']
                            [subfield[@code='a'][.='Backbuch']]
                    /subfield[@code='0']
                            [.='(DE-588)7502992-3']
                            /text()"</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
  <span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">text</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span><span style="color: #556b72; background-color: #FDF6E3;">(DE-588)1071926306</span><span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">text</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
<span style="color: #556b72; background-color: #FDF6E3;">&lt;</span><span style="color: #556b72; background-color: #FDF6E3;">/</span><span style="color: #d33682; font-style: italic;">xsl</span><span style="color: #556b72; background-color: #FDF6E3;">:</span><span style="color: #b58900;">template</span><span style="color: #556b72; background-color: #FDF6E3;">&gt;</span>
</pre>
</div>

<p>
Im Prinzip wie die vorige Lösung, nur noch gezielter. Ob die Absicht hier so gut zu erkennen ist, weiß ich nicht.
</p>
</div>
</li>
</ul>
</div>
</div>
<div id="outline-container-org8c130fc" class="outline-3">
<h3 id="org8c130fc">ex05: LDR/19 je nach Gegebenheiten setzen</h3>
<div class="outline-text-3" id="text-org8c130fc">
<p>
<a href="https://share.obvsg.at/xsldocs/xslt-normalization/OBV_normalize-on-save/index.html#stylesheet;src/leader.xsl">https://share.obvsg.at/xsldocs/xslt-normalization/OBV_normalize-on-save/index.html#stylesheet;src/leader.xsl</a>
</p>
</div>
</div>
<div id="outline-container-org571224f" class="outline-3">
<h3 id="org571224f">ex06: 773 bearbeiten</h3>
<div class="outline-text-3" id="text-org571224f">
<ul class="org-ul">
<li><a href="https://share.obvsg.at/xsldocs/xslt-normalization/OBV_normalize-on-save/index.html#temp;datafield%5C%5B@tag='773'%5C%5D/@ind1%7Cdatafield%5C%5B@tag='773'%5C%5D/@ind2;nil">Indikatoren fix auf <code>08</code> setzen</a></li>
<li><a href="https://share.obvsg.at/xsldocs/xslt-normalization/OBV_normalize-on-save/index.html#temp;datafield%5C%5B@tag='773'%5C%5D/subfield%5C%5B@code='a'%5C%5D;nil">Subfeld a löschen</a></li>
<li><a href="https://share.obvsg.at/xsldocs/xslt-normalization/OBV_normalize-on-save/index.html#temp;datafield%5B@tag='773'%5D%5Bsubfield%5B@code='i'%5D%5B.='Enthalten%20in'%5D%5D;nil">77308$$d bei Aufsätzen aus 264 generieren</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgf5dd7b1" class="outline-3">
<h3 id="orgf5dd7b1">ex07: Ein ganzer Datensatz</h3>
<div class="outline-text-3" id="text-orgf5dd7b1">
<p>
Wir haben eine E-Book Lieferung. Bei den enthaltenen Datensätzen ist folgendes zu tun:
</p>

<ul class="org-ul">
<li><code>LDR/18</code> auf <code>c</code> setzen</li>
<li><code>008</code>
<ul class="org-ul">
<li><code>008/07-10</code> mit dem Jahr aus <code>264</code> befüllen</li>
<li><code>008/23</code> auf &ldquo;o&rdquo; setzen</li>
</ul></li>
<li><code>041</code> aus <code>008/35-37</code> generieren</li>
<li><code>245</code>
<ul class="org-ul">
<li>Nichtsortierzeichen einfügen</li>
</ul></li>
<li><code>336</code>, <code>337</code>, <code>338</code> SFa und SF2 entfernen</li>
<li><code>260</code> durch <code>264</code> ersetzen</li>
<li>ISBD-Interpunktion entfernen</li>
<li><code>9XX</code> löschen</li>
<li>Output sortieren</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgc643de7" class="outline-2">
<h2 id="orgc643de7">Spezifikationen</h2>
<div class="outline-text-2" id="text-orgc643de7">
<dl class="org-dl">
<dt>XPathXML Path Language (XPath) 3.1</dt><dd><a href="https://www.w3.org/TR/xpath-31/">https://www.w3.org/TR/xpath-31/</a></dd>
<dt>XDMXQuery and XPath Data Model (XDM) 3.1</dt><dd><a href="https://www.w3.org/TR/xpath-datamodel-31/">https://www.w3.org/TR/xpath-datamodel-31/</a></dd>
<dt>XPath and XQuery Functions and Operators 3.1</dt><dd><a href="https://www.w3.org/TR/xpath-functions-31/">https://www.w3.org/TR/xpath-functions-31/</a></dd>
<dt>XSL Transformations (XSLT) Version 3.0</dt><dd><a href="https://www.w3.org/TR/xslt-30/">https://www.w3.org/TR/xslt-30/</a></dd>
</dl>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Stefan Schuh</p>
<p class="date">Created: 2026-02-04 Mi 16:53</p>
</div>
</body>
</html>
